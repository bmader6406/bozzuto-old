<% content_for :body_class do %>community property<% end %>
<% render_meta(@community) %>

<div class="row">
  <div id="content" class="col">
    <div id="overview">
      <%= property_icons(@community) %>

      <% if @community.overview_title.present? %>
        <h2><%= @community.overview_title %></h2>
      <% end %>

      <div class="intro">
        <p>
          <%= truncate(@community.overview_text.gsub(/<\/?[^>]*>/,  ""), :length => 300, :omission => "&hellip;").try(:html_safe) %>
        </p>
      </div>

      <%= property_bullets %>

      <p>
        <%= link_to 'Read More', features_apartment_community_path(@community) %>
      </p>

      <%= property_icon_descriptions %>
    </div>

    <% if @community.promo_image? %>
      <div class="promo">
        <p>
          <%= link_to @community.promo_url, image_tag(@community.promo_image) %>
        </p>
      </div>
    <% end %>

    <div id="apartments">
      <h2>Apartments</h2>

      <table>
        <tbody>
          <% ApartmentFloorPlanGroup.all.each do |group| %>
            <% plans_in_group = @community.floor_plans.in_group(group) %>
            <% unless plans_in_group.empty? %>
              <tr>
                <td>
                  <%= link_to group.name, apartment_community_floor_plan_groups_path(@community, :anchor => dom_id(group)) %>
                </td>
                <td>
                  <%= pluralize(plans_in_group.count, 'Floor Plan') %>
                </td>
                <td>
                  <% unless plans_in_group.empty? %>
                    <%= square_feet(plans_in_group.largest.first) %>
                  <% end %>
                </td>
                <td>
                  <% unless plans_in_group.empty? %>
                    From <%= floor_plan_price(plans_in_group.cheapest.first.min_rent) %>
                  <% end %>
                </td>
                <td class="availability">
                  <%= link_to "Availability", @community.availability_url %>
                </td>
              </tr>
            <% end %>
          <% end %>
        </tbody>
      </table>
    </div>

    <% if @community.featured_floor_plans.any? %>
      <div id="featured-floor-plans">
        <h2>Featured Floor Plans</h2>

        <ul class="row">
          <% @community.featured_floor_plans.take(3).each do |plan| %>
            <li class="floor-plan">
              <h4><%= plan.name %></h4>
              <p>
                <%= square_feet(plan) %> |
                <%= floor_plan_price(plan.min_rent) %>

                <% if plan.availability_url.present? %>
                  <br />
                  <%= link_to 'Reserve', plan.availability_url %>
                <% end %>
              </p>

              <%= floor_plan_image(plan) %>
            </li>
          <% end %>
        </ul>
      </div>
    <% end %>
  </div>

  <%= render :partial => 'sidebar' %>
</div>
